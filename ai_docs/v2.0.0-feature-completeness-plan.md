# xcodeproj-cli v2.0.0 Complete Implementation Plan (UPDATED)

## Overview
This document consolidates the original v2.0.0 plan with high-priority features discovered during XcodeProj library research. The goal is to ship v2.0.0 as a feature-complete, professional-grade tool that leverages the full power of XcodeProj.

## Timeline Estimate
- **Original v2.0 Work**: 8-10 hours
- **Additional Priority Features**: 15-20 hours  
- **Total Effort**: 23-30 hours
- **Testing**: 5-6 hours
- **Documentation**: 2-3 hours

---

## Part A: Original v2.0.0 Implementation (From Previous Plan)

### Phase 1: Critical Security Fixes (1 hour) ✅ COMPLETED
- ✅ Command injection vulnerability fixes
- ✅ Path traversal protection
- ✅ Force unwrapping removal
- ✅ Transaction race condition fix

### Phase 2: Fix Test Suite (1 hour) ✅ COMPLETED
- ✅ Updated test file references
- ✅ Added build step to test scripts
- ✅ Created TestHelper for binary path

### Phase 3: Modular Architecture Refactoring (4-5 hours) ✅ COMPLETED
- ✅ Created modular directory structure
- ✅ Extracted models, commands, core services
- ✅ Implemented command registry
- ✅ Simplified main entry point

### Phase 4: Decompose Complex Functions (2 hours) - PARTIAL
- ⚠️ Some complex functions remain (will address with new features)

### Phase 5: Add Comprehensive Tests (2 hours) - PENDING
- Will be combined with new feature testing

---

## Part B: High-Priority New Features for v2.0.0

### Priority 1: Scheme Management (6 hours) - ESSENTIAL

#### 1.1 Basic Scheme Operations
**New Commands**:
```bash
# Core scheme commands
create-scheme <name> --target <target> [--shared]
duplicate-scheme <source> <destination>  
remove-scheme <name>
list-schemes [--shared]

# Basic configuration
set-scheme-config <scheme> --build <config> --run <config> --test <config>
add-scheme-target <scheme> <target> --action <build|test|run>
```

**Implementation Files**:
- `Commands/SchemeCommands/CreateSchemeCommand.swift`
- `Commands/SchemeCommands/ListSchemesCommand.swift`
- `Commands/SchemeCommands/RemoveSchemeCommand.swift`
- `Commands/SchemeCommands/SetSchemeConfigCommand.swift`
- `Core/SchemeManager.swift`

#### 1.2 Test Configuration
**New Commands**:
```bash
enable-test-coverage <scheme> [--targets <target1,target2>]
set-test-parallel <scheme> --enable/--disable
```

### Priority 2: Workspace Support (4 hours) - CRITICAL

**New Commands**:
```bash
# Workspace basics
create-workspace <name>
add-project-to-workspace <workspace> <project>
remove-project-from-workspace <workspace> <project>
list-workspace-projects <workspace>

# Cross-project references
add-project-reference <project-path> [--group <group>]
add-cross-project-dependency <target> <external-project> <external-target>
```

**Implementation Files**:
- `Commands/WorkspaceCommands/CreateWorkspaceCommand.swift`
- `Commands/WorkspaceCommands/AddProjectCommand.swift`
- `Commands/WorkspaceCommands/ListProjectsCommand.swift`
- `Core/WorkspaceManager.swift`
- `Core/CrossProjectManager.swift`

### Priority 3: Enhanced Build Phases (4 hours) - IMPORTANT

#### 3.1 Complete Build Phase Support
**New Commands**:
```bash
# Headers build phase
add-headers-phase <target> [--public <files>] [--private <files>]
set-header-visibility <target> <file> <public|private|project>

# Enhanced copy phase
add-copy-phase <target> <name> --destination <dest> [--subpath <path>]
# Destinations: wrapper, resources, executables, frameworks, shared-support

# Enhanced run script
add-run-script <target> <name> --script <script> 
  [--input-paths <paths>] [--output-paths <paths>]
  [--shell <shell>]

# Build phase management
reorder-build-phases <target> <phase-index1> <phase-index2>
list-build-phases <target> [--verbose]
```

**Implementation Files**:
- `Commands/BuildCommands/AddHeadersPhaseCommand.swift`
- `Commands/BuildCommands/AddCopyPhaseCommand.swift`
- `Commands/BuildCommands/AddRunScriptCommand.swift`
- `Commands/BuildCommands/ReorderPhasesCommand.swift`
- Update existing `Core/BuildPhaseManager.swift`

### Priority 4: Build Configuration Management (3 hours)

#### 4.1 Configuration Files
**New Commands**:
```bash
add-config-file <config> <file-path> [--target <target>]
remove-config-file <config> [--target <target>]
list-config-files
```

#### 4.2 Build Settings Tools
**New Commands**:
```bash
copy-build-settings <source-config> <dest-config> [--target <target>]
diff-build-settings <config1> <config2> [--target <target>]
export-build-settings <config> --output <file> [--format json|xcconfig]
```

**Implementation Files**:
- `Commands/BuildCommands/ConfigFileCommand.swift`
- `Commands/BuildCommands/BuildSettingsToolsCommand.swift`
- `Core/BuildConfigurationManager.swift`

### Priority 5: Localization Support (3 hours)

**New Commands**:
```bash
# Basic localization
add-localization <language-code>
remove-localization <language-code>
list-localizations

# Variant groups
create-variant-group <name> <base-file> [--languages <langs>]
add-localized-resource <file> <language> [--group <group>]
```

**Implementation Files**:
- `Commands/LocalizationCommands/AddLocalizationCommand.swift`
- `Commands/LocalizationCommands/VariantGroupCommand.swift`
- `Core/LocalizationManager.swift`

### Priority 6: Extended Target Types (2 hours)

**New Commands**:
```bash
# Additional target types
add-aggregate-target <name> [--build-phases <phases>]
add-extension-target <name> --type <type> --bundle-id <id>
# Types: widget, intent, app-clip, etc.

# Target attributes
set-target-attributes <target> --attributes <key=value>
```

**Implementation Files**:
- `Commands/TargetCommands/AddAggregateTargetCommand.swift`
- `Commands/TargetCommands/AddExtensionTargetCommand.swift`
- Update existing target commands

---

## Part C: Deferred to Post-2.0 Release

The following features from the research will be implemented after v2.0.0:

### Version 2.1.0 - Advanced Build & Testing (Est. 2-3 weeks after v2.0)
**Focus: Professional build system and testing features**

#### Test Plans Support (4 hours)
- `create-test-plan <name> [--targets <targets>]` - Create Xcode 11+ test plans
- `add-test-to-plan <plan> <test-class>` - Add specific tests to plan
- `set-test-configuration <plan> --language <lang> --region <region>` - Configure test environments
- `set-test-options <plan> --parallel --randomize` - Set execution options

#### Build Rules (3 hours)
- `add-build-rule <target> --pattern <pattern> --script <script>` - Custom build rules
- `list-build-rules <target>` - View existing rules
- `set-build-rule-compiler <target> <rule-id> <compiler>` - Configure rule compiler

#### Advanced Scheme Actions (3 hours)
- `set-scheme-profile-action <scheme> --config <config>` - Profile action setup
- `set-scheme-analyze-action <scheme> --config <config>` - Analyze action setup
- `set-scheme-archive-action <scheme> --config <config> --name <name>` - Archive configuration
- `add-scheme-pre-action <scheme> <action> --script <script>` - Pre/post actions

#### Version Groups for Core Data (2 hours)
- `create-version-group <name> --type xcdatamodel` - Create versioned Core Data models
- `add-model-version <group> <version-name>` - Add new model version
- `set-current-version <group> <version>` - Set active model version

### Version 2.2.0 - Analysis & Optimization (Est. 1 month after v2.1)
**Focus: Project health, optimization, and migration tools**

#### Project Analysis Tools (4 hours)
- `analyze-project [--report <file>]` - Comprehensive project health check
- `find-unused-resources` - Identify unused images, xibs, strings
- `find-duplicate-files` - Detect duplicate resources
- `generate-dependency-graph --output <file>` - Visualize target dependencies
- `find-circular-dependencies` - Detect dependency cycles

#### Migration Utilities (3 hours)
- `migrate-swift-version <version> [--targets <targets>]` - Update Swift version
- `update-deployment-target <platform> <version>` - Bulk update deployment targets
- `convert-to-packages [--targets <targets>]` - Convert targets to Swift packages
- `modernize-build-settings` - Update deprecated settings

#### Batch Operations & Templates (3 hours)
- `batch-execute <commands-file>` - Run multiple commands from file
- `apply-template <template-file>` - Apply project templates
- `export-project-template --output <file>` - Create reusable templates
- `record-macro <name>` - Record command sequences

#### Project Optimization (2 hours)
- `optimize-project [--remove-duplicates] [--clean-settings]` - Auto-optimize
- `consolidate-build-settings` - Move common settings to project level
- `clean-derived-data-references` - Remove stale DerivedData refs
- `optimize-build-phases` - Reorder for optimal build times

### Version 2.3.0 - Enterprise Features (Future)
**Focus: Large team and CI/CD features**

#### Container and Reference Proxies (4 hours)
- `create-container-proxy <project-ref> <target>` - Advanced cross-project setup
- `add-reference-proxy <path> --type <file|product>` - External references
- `setup-framework-umbrella <frameworks...>` - Umbrella framework creation

#### Source Control Integration (2 hours)
- `add-remote-repository <url> --name <name>` - Configure remotes
- `set-source-control-enabled <true|false>` - Toggle source control
- `generate-gitignore` - Create optimized .gitignore

#### CI/CD Integration (3 hours)
- `generate-ci-config --platform <github|gitlab|jenkins>` - CI configuration
- `validate-for-ci` - Pre-flight CI checks
- `export-build-matrix` - Generate build matrix for CI

---

## Implementation Order for v2.0.0

### Week 1 (Days 1-3): Foundation
1. **Day 1**: Scheme Management basics (4 hours)
   - Create, list, remove schemes
   - Basic configuration

2. **Day 2**: Workspace Support (4 hours)
   - Create workspaces
   - Add/remove projects
   
3. **Day 3**: Cross-project references (4 hours)
   - Project references
   - Cross-project dependencies

### Week 2 (Days 4-6): Build System
4. **Day 4**: Enhanced Build Phases (4 hours)
   - Headers, Copy phases
   - Enhanced run scripts
   
5. **Day 5**: Build Configuration (3 hours)
   - Config files
   - Build settings tools
   
6. **Day 6**: Testing & Polish (3 hours)
   - Scheme test configuration
   - Build phase management

### Week 3 (Days 7-8): Completion
7. **Day 7**: Localization & Extended Targets (5 hours)
   - Localization support
   - Variant groups
   - Extended target types

8. **Day 8**: Testing & Documentation (5 hours)
   - Comprehensive testing
   - Update documentation
   - Prepare release

---

## Testing Strategy

### Unit Tests
- Test each new command
- Validate scheme XML generation
- Test workspace file format
- Verify cross-project references

### Integration Tests  
- Multi-project workspace scenarios
- Scheme creation and modification
- Build phase ordering
- Localization workflows

### Regression Tests
- Ensure all existing commands work
- Verify performance isn't degraded
- Test backward compatibility

---

## Documentation Updates

### README.md Additions
- New "Advanced Features" section
- Scheme management guide
- Workspace usage examples
- Cross-project setup tutorial

### CHANGELOG.md
```markdown
## [2.0.0] - 2024-XX-XX
### Added
- Complete scheme management (create, modify, configure)
- Workspace support with cross-project references
- Enhanced build phases (headers, copy destinations, run scripts)
- Build configuration file support (.xcconfig)
- Localization and variant groups
- Extended target types (aggregate, extensions)
- 35+ new commands

### Changed
- Refactored to modular architecture
- Improved performance with caching
- Enhanced error messages

### Fixed
- Security vulnerabilities in path handling
- Test suite compatibility
- Complex function decomposition
```

---

## Success Criteria for v2.0.0

### Must Have (Release Blockers)
✅ Security fixes completed
✅ Modular architecture implemented
✅ Basic scheme management working
✅ Workspace creation and project management
✅ Enhanced build phases
✅ All tests passing
✅ Documentation updated

### Should Have
✅ Cross-project dependencies
✅ Build configuration tools
✅ Localization support
✅ Extended target types

### Nice to Have (Can defer)
- Test plans
- Build rules  
- Migration tools
- Analysis tools

---

## Risk Mitigation

### Technical Risks
1. **Scheme Compatibility**: Test with Xcode 14, 15, 16
2. **Workspace Format**: Validate against real projects
3. **Performance**: Profile with large projects

### Mitigation
- Beta test with select users
- Keep rollback capability
- Incremental feature release if needed

---

## Post-Release Roadmap Summary

### v2.1.0 - Advanced Build & Testing (2-3 weeks after v2.0)
- **Test Plans**: Full Xcode 11+ test plan support with configuration
- **Build Rules**: Custom build rules with patterns and scripts  
- **Advanced Schemes**: Profile, Analyze, Archive actions with pre/post scripts
- **Core Data**: Version groups for xcdatamodel files
- **Est. Commands**: 15+ new commands

### v2.2.0 - Analysis & Optimization (1 month after v2.1)
- **Project Analysis**: Find unused resources, duplicates, circular dependencies
- **Migration Tools**: Swift version, deployment targets, convert to packages
- **Batch Operations**: Templates, macros, bulk commands
- **Optimization**: Auto-optimize settings, build phases, remove cruft
- **Est. Commands**: 20+ new commands

### v2.3.0 - Enterprise Features (Future)
- **Advanced Proxies**: Container and reference proxies for complex setups
- **Source Control**: Repository management, gitignore generation
- **CI/CD Integration**: Generate configs for GitHub Actions, GitLab, Jenkins
- **Est. Commands**: 10+ new commands

### v3.0.0 - Next Generation (Future)
- GUI companion app for visual project management
- Cloud collaboration and team features
- AI-powered project optimization suggestions
- Real-time project sync across teams

---

## Conclusion

This updated plan transforms v2.0.0 from a refactoring release into a feature-rich major version that establishes xcodeproj-cli as the premier command-line tool for Xcode project management. By incorporating the most valuable features from the XcodeProj library research, we're delivering immediate value while setting up a clear roadmap for future enhancements.

The implementation is ambitious but achievable, with clear priorities and fallback options if timeline becomes constrained.