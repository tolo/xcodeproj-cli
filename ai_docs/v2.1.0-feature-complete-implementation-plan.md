# xcodeproj-cli v2.1.0 Feature-Complete Implementation Plan

## Executive Summary
This plan identifies and addresses missing functionality from the XcodeProj library that would make xcodeproj-cli a truly comprehensive Xcode project manipulation tool. After deep research of XcodeProj's capabilities, I've identified 25+ major features that are not yet implemented.

## Timeline Estimate
- **Total Effort**: 40-50 hours of focused development
- **Testing**: 10-15 hours additional
- **Documentation**: 5 hours

---

## Part 1: Scheme Management (8 hours)

### 1.1 Full Scheme Support
**Missing Features**: Complete scheme creation, modification, and management

**New Commands**:
```bash
# Scheme creation and management
create-scheme <name> --target <target> [--shared]
duplicate-scheme <source> <destination>
remove-scheme <name>
list-schemes [--shared]

# Scheme configuration
set-scheme-action <scheme> <action> --config <config>
add-scheme-target <scheme> <target> --action <build|test|run>
set-scheme-env-var <scheme> <key> <value> --action <action>
set-scheme-arguments <scheme> <arguments> --action <action>

# Test configuration
enable-test-coverage <scheme> [--targets <target1,target2>]
set-test-parallel <scheme> --enable/--disable
add-test-plan <scheme> <test-plan-path>
```

**Implementation Details**:
- Use XCScheme class for scheme manipulation
- Support all 6 scheme actions (Build, Test, Launch, Profile, Analyze, Archive)
- Handle both shared and user-specific schemes
- Support test coverage configuration
- Support environment variables and launch arguments

### 1.2 Test Plan Support
**New Commands**:
```bash
create-test-plan <name> [--targets <targets>]
add-test-to-plan <plan> <test-class> [--test-methods <methods>]
set-test-configuration <plan> --language <lang> --region <region>
set-test-options <plan> --parallel --randomize
```

---

## Part 2: Build Configuration Management (6 hours)

### 2.1 Build Rules
**Missing Features**: Custom build rule creation and management

**New Commands**:
```bash
add-build-rule <target> --pattern <pattern> --script <script> [--output <output>]
list-build-rules <target>
remove-build-rule <target> <rule-id>
set-build-rule-compiler <target> <rule-id> <compiler>
```

### 2.2 Configuration Files (.xcconfig)
**New Commands**:
```bash
add-config-file <config> <file-path> [--target <target>]
remove-config-file <config> [--target <target>]
list-config-files
create-config-file <name> --settings <key=value,key2=value2>
```

### 2.3 Build Settings Enhancement
**New Commands**:
```bash
copy-build-settings <source-config> <dest-config> [--target <target>]
diff-build-settings <config1> <config2> [--target <target>]
export-build-settings <config> --output <file> [--format json|xcconfig]
import-build-settings <config> --input <file>
```

---

## Part 3: Advanced Build Phases (8 hours)

### 3.1 Complete Build Phase Types
**Missing Features**: Headers, Rez, and specialized copy phases

**New Commands**:
```bash
# Headers build phase
add-headers-phase <target> [--public <files>] [--private <files>]
set-header-visibility <target> <file> <public|private|project>

# Copy files build phase with destinations
add-copy-phase <target> <name> --destination <dest> [--subpath <path>]
# Destinations: wrapper, resources, executables, frameworks, shared-support, plugins, etc.

# Run script enhancements
add-run-script <target> <name> --script <script> 
  [--input-paths <paths>] [--output-paths <paths>]
  [--input-file-lists <lists>] [--output-file-lists <lists>]
  [--shell <shell>] [--show-env-vars]

# Build phase management
reorder-build-phases <target> <phase1> <phase2>
rename-build-phase <target> <old-name> <new-name>
disable-build-phase <target> <phase-name>
```

### 3.2 Build Phase Dependencies
**New Commands**:
```bash
set-phase-dependencies <target> <phase> --depends-on <phases>
set-phase-run-condition <target> <phase> --condition <always|deployment-only>
```

---

## Part 4: Workspace Management (6 hours)

### 4.1 Workspace Creation and Management
**New Commands**:
```bash
create-workspace <name>
add-project-to-workspace <workspace> <project>
remove-project-from-workspace <workspace> <project>
list-workspace-projects <workspace>
set-workspace-location <workspace> <project> --location <path>
```

### 4.2 Cross-Project References
**New Commands**:
```bash
add-project-reference <project-path> [--group <group>]
add-cross-project-dependency <target> <external-project> <external-target>
link-cross-project-framework <target> <external-project> <framework-target>
embed-cross-project-framework <target> <external-project> <framework-target>
```

---

## Part 5: Localization Support (5 hours)

### 5.1 Variant Groups and Localization
**New Commands**:
```bash
add-localization <language-code>
remove-localization <language-code>
list-localizations
add-localized-resource <file> <language> [--group <group>]
create-variant-group <name> <base-file> [--languages <langs>]
add-to-variant-group <group> <file> <language>
```

### 5.2 Info.plist Localization
**New Commands**:
```bash
localize-info-plist <target> <languages>
add-info-plist-string <key> <value> --language <lang>
```

---

## Part 6: Version Control Integration (4 hours)

### 6.1 Version Groups (Core Data)
**New Commands**:
```bash
create-version-group <name> --type <xcdatamodel>
add-model-version <group> <version-name>
set-current-version <group> <version>
list-model-versions <group>
```

### 6.2 Source Control Management
**New Commands**:
```bash
add-remote-repository <url> --name <name>
list-repositories
set-source-control-enabled <true|false>
```

---

## Part 7: Target Enhancements (6 hours)

### 7.1 Product Types and Target Creation
**New Commands**:
```bash
# Extended target types
add-aggregate-target <name> [--build-phases <phases>]
add-legacy-target <name> --build-tool <tool> --arguments <args>
add-extension-target <name> --type <type> --bundle-id <id>
# Types: app-extension, widget, intent, background-assets, etc.

# Target configuration
set-target-product-type <target> <product-type>
set-target-deployment <target> --platform <platform> --version <version>
set-target-capabilities <target> --capability <cap> --enabled
```

### 7.2 Target Dependencies and Embedding
**New Commands**:
```bash
add-embedded-binary <target> <binary-path> [--sign-on-copy]
add-target-membership <file> <targets...>
remove-target-membership <file> <targets...>
list-target-memberships <file>
set-target-attributes <target> --attributes <key=value>
```

---

## Part 8: Advanced Project Features (5 hours)

### 8.1 Project-Wide Operations
**New Commands**:
```bash
# Project attributes
set-project-attribute <key> <value>
list-project-attributes
set-development-region <region>
set-organization-name <name>
set-class-prefix <prefix>

# Known regions
add-known-region <region>
remove-known-region <region>
list-known-regions

# File encoding
set-file-encoding <file> <encoding>
set-file-line-endings <file> <unix|windows|classic>
```

### 8.2 File Reference Enhancements
**New Commands**:
```bash
set-file-type <file> <explicit-type>
set-file-language <file> <language-id>
set-file-indentation <file> --tabs <width> | --spaces <count>
set-file-wrapping <file> --enabled --margin <margin>
```

---

## Part 9: Container and Proxy Support (4 hours)

### 9.1 Container Item Proxies
**New Commands**:
```bash
create-container-proxy <project-ref> <target> --type <native|reference>
list-container-proxies
remove-container-proxy <proxy-id>
```

### 9.2 Reference Proxies
**New Commands**:
```bash
add-reference-proxy <path> --type <file|product>
update-reference-proxy <proxy> --remote-ref <ref>
list-reference-proxies
```

---

## Part 10: Quality of Life Improvements (3 hours)

### 10.1 Batch Operations
**New Commands**:
```bash
batch-execute <commands-file>
apply-template <template-file> [--variables <key=value>]
export-project-template --output <file>
```

### 10.2 Project Analysis
**New Commands**:
```bash
analyze-project [--report <file>]
find-unused-resources
find-duplicate-files
optimize-project [--remove-duplicates] [--clean-build-settings]
generate-dependency-graph --output <file> [--format dot|json]
```

### 10.3 Migration Tools
**New Commands**:
```bash
migrate-swift-version <version> [--targets <targets>]
update-deployment-target <platform> <version> [--targets <targets>]
convert-to-packages [--targets <targets>]
```

---

## Implementation Strategy

### Phase 1: Foundation (Week 1-2)
1. Implement Scheme management (most requested feature)
2. Add Workspace support
3. Enhance build phase capabilities

### Phase 2: Advanced Features (Week 3-4)
1. Localization support
2. Cross-project references
3. Build rules and configuration files

### Phase 3: Target Enhancements (Week 5)
1. Extended target types
2. Product type management
3. Embedding and dependencies

### Phase 4: Polish (Week 6)
1. Batch operations
2. Analysis tools
3. Migration utilities

---

## Technical Considerations

### API Usage
- Leverage full XCScheme API for scheme manipulation
- Use XCWorkspace for workspace operations
- Implement PBXContainerItemProxy for cross-project references
- Support PBXVariantGroup for localization
- Use XCVersionGroup for Core Data models

### Error Handling
- Validate all cross-project references
- Check for circular dependencies
- Verify file existence for localized resources
- Validate scheme action configurations

### Performance
- Cache scheme data for batch operations
- Optimize cross-project reference resolution
- Implement lazy loading for workspace projects

---

## Testing Requirements

### Unit Tests
- Test each new command individually
- Validate scheme XML generation
- Test workspace file format
- Verify localization structures

### Integration Tests
- Multi-project workspace scenarios
- Cross-project dependency chains
- Scheme action combinations
- Localization workflows

### Regression Tests
- Ensure backward compatibility
- Verify existing commands still work
- Test migration paths

---

## Documentation Updates

### README Enhancements
- Add scheme management section
- Document workspace workflows
- Provide localization examples
- Include cross-project setup guide

### Command Reference
- Document all 100+ new commands
- Provide usage examples
- Include common workflows
- Add troubleshooting guide

### Tutorials
- "Working with Schemes"
- "Multi-Project Workspaces"
- "Localization Best Practices"
- "Advanced Build Configuration"

---

## Success Metrics

### Feature Completeness
✅ Full scheme management (creation, modification, all actions)
✅ Complete workspace support
✅ All build phase types implemented
✅ Localization and variant groups
✅ Cross-project references
✅ All target types supported
✅ Build rules and custom configurations
✅ Version groups for Core Data
✅ Container and reference proxies
✅ 100+ new commands

### Quality Metrics
- 90%+ test coverage for new features
- All commands documented with examples
- Performance benchmarks for large projects
- Zero regression in existing functionality

---

## Risk Mitigation

### Technical Risks
1. **Scheme XML Compatibility**: Test with multiple Xcode versions
2. **Cross-Project References**: Validate path resolution thoroughly
3. **Workspace Format Changes**: Monitor Xcode updates
4. **Performance with Large Projects**: Implement caching strategically

### Mitigation Strategies
- Incremental rollout of features
- Beta testing program for complex features
- Comprehensive error messages
- Rollback capabilities for destructive operations

---

## Conclusion

This implementation plan would transform xcodeproj-cli from a useful utility into a comprehensive, feature-complete Xcode project manipulation tool that leverages the full power of the XcodeProj library. The additions would make it suitable for:

- Enterprise-scale iOS/macOS development
- Complex multi-project architectures
- Automated CI/CD pipelines
- Project migration and modernization
- Advanced build system customization

With these features, xcodeproj-cli would become the definitive command-line tool for Xcode project management, surpassing even Xcode's own command-line capabilities in many areas.